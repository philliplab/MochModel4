# Scenario Report
```{r, include=FALSE,eval=FALSE}
source('MochModel4GenerateScenarioReports.R')
scenario <- list(scex = 'Base')
```

```{r, include=FALSE}
source('MochModel4Tests_helpers.R')
rerun_models <- FALSE
rerun_models <- TRUE
options(scipen=999)
library(modgenTester)
library(knitr)
library(plyr)
library(survival)
library(reshape2)
library(survMisc)
library(gridExtra)
library(digest)
odbcCloseAll()
opts_chunk$set(echo = FALSE)
opts_chunk$set(fig.height = 10)
opts_chunk$set(fig.width = 10)
sd <- "C:/Users/Administrator/Documents/Visual Studio 2010/Projects/MochModel4"
td <- "C:/Users/Administrator/Documents/Visual Studio 2010/Projects/MochModel4/test"
setwd(td)

scenario_name <- gsub(".scex", "", scenario$scex)
all_results <- list_all_results(td)
result <- all_results[[grep(scenario_name, all_results)]]
db_channel <- access_database(result)

ModelVersion <- as.data.frame(new_RTable("ModelVersion", db_channel))$Value[1]
```

## Model Version: `r ModelVersion`
## Scenario: `r scenario_name`

### Population Stats
```{r}
total_mother_population <- get_mother_population_size(db_channel)

cgd <- as.data.frame(new_RTable('ChildGenderDistribution', db_channel))
cgd <- subset(cgd, metrics == 'Number of Children')[,1:3]
num_female <- subset(cgd, gender == 'F', select = 'Value')
stopifnot(nrow(num_female) == 1)
num_female <- num_female[1,1]
total_child_population <- sum(cgd$Value)
```

There are `r total_mother_population` Mothers in this scenario.

There are `r total_child_population` Children in this scenario.

### State Transitions

A table of the number of mothers who entered each of the different states.

```{r, results='asis'}
mmea <- as.data.frame(new_RTable('MotherMDEntrancesxAge', db_channel))[,1:3]
state_entrances <- tapply(mmea$Value, mmea$metrics, sum)
state_entrances <- data.frame(state = names(state_entrances),
                              entrances = state_entrances,
                              percentage = round((state_entrances / total_mother_population) * 100,1))
row.names(state_entrances) <- 1:nrow(state_entrances)
kable(state_entrances)
```

### State Membership

The total time spent by mothers in the various states.

```{r, results='asis'}
mmma <- as.data.frame(new_RTable('MotherMDMembershipxAge', db_channel))[,1:3]
state_membership <- tapply(mmma$Value, mmma$metrics, sum)
total_mother_years <- sum(state_membership)
state_membership <- data.frame(state = names(state_membership),
                               mother_years = state_membership,
                               percentage = round((state_membership / total_mother_years) * 100,1))
row.names(state_membership) <- 1:nrow(state_membership)
kable(state_membership)
```


```{r}
odbcCloseAll()
```
